<!DOCTYPE HTML>
<html>
	<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Blog Title</title><!-- &mdash; -->
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Blog Description" />
	<meta name="keywords" content="English, Authentic" />
	<meta name="author" content="MichaelLedger" />

  	<!-- Facebook and Twitter integration -->
	<meta property="og:title" content=""/>
	<meta property="og:image" content=""/>
	<meta property="og:url" content=""/>
	<meta property="og:site_name" content=""/>
	<meta property="og:description" content=""/>
	<meta name="twitter:title" content="" />
	<meta name="twitter:image" content="" />
	<meta name="twitter:url" content="" />
	<meta name="twitter:card" content="" />

	<link href="https://fonts.googleapis.com/css?family=Work+Sans:300,400,500,700,800" rel="stylesheet">
	
	<!-- Animate.css -->
	<link rel="stylesheet" href="css/animate.css">
	<!-- Icomoon Icon Fonts-->
	<link rel="stylesheet" href="css/icomoon.css">
	<!-- Bootstrap  -->
	<link rel="stylesheet" href="css/bootstrap.css">
	
	<!-- Theme style  -->
	<link rel="stylesheet" href="css/style.css">

	<!-- Modernizr JS -->
	<script src="js/modernizr-2.6.2.min.js"></script>
	<!-- FOR IE9 below -->
	<!--[if lt IE 9]>
	<script src="js/respond.min.js"></script>
	<![endif]-->

	<!-- Markdown JS -->
	<!-- https://github.com/showdownjs/showdown -->
	<!-- <script src="../public/showdown/dist/showdown.min.js"></script> -->

	</head>
	<body class="single">
		
	<div class="fh5co-loader"></div>
	
	<div id="page">
		<div id="fh5co-aside" style="background-image: url()" data-stellar-background-ratio="0.5">
			<div class="overlay"></div>
			<div class="page-title">
				<!-- <img src="images/person_4.jpg" alt="portrait"> -->
				<span id="post-date">Date</span>
				<h2 id="post-title">Title</h2>
			</div>
			<nav role="navigation">
				<ul>
					<li><a href="index.html"><i class="icon-home"></i></a></li>
				</ul>
			</nav>
		</div>
		<div id="fh5co-main-content">
			<div class="fh5co-post"> 
				<div class="fh5co-entry padding">
					<div id="english-content" class="post-content">
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="fh5co-navigation">
		<div class="fh5co-cover prev fh5co-cover-sm" id="previous-post-cover" style="background-image: url()">
			<div class="overlay"></div>

			<a class="copy" href="#" id="pervious-post-location">
				<div class="display-t">
					<div class="display-tc">
						<div>
							<span>Previous Post</span>
							<h2 id="pervious-post-title">Previous Post Title</h2>
						</div>
					</div>
				</div>
			</a>

		</div>
		<div class="fh5co-cover next fh5co-cover-sm" id="next-post-cover" style="background-image: url()">
			<div class="overlay"></div>
			<a class="copy" href="#" id="next-post-location">
				<div class="display-t">
					<div class="display-tc">
						<div>
							<span>Next Post</span>
							<h2 id="next-post-title">Next Post Title</h2>
						</div>
					</div>
				</div>
			</a>

		</div>
	</div>

	<footer>
		<div>
			Copyright &copy; 2018 MTX Software Technology Co.,Ltd. All rights reserved. Designed by <a href="index.html" target="_blank">MichaelLedger</a>.
			<br/>
			For personal study only, please do not reprint, not for any commercial use.</p>
		</div>
	</footer>

	<div class="gototop js-top">
		<a href="#" class="js-gotop"><i class="icon-arrow-up"></i></a>
	</div>
	
	<!-- jQuery -->
	<script src="js/jquery.min.js"></script>
	<!-- jQuery Easing -->
	<script src="js/jquery.easing.1.3.js"></script>
	<!-- Bootstrap -->
	<script src="js/bootstrap.min.js"></script>
	<!-- Waypoints -->
	<script src="js/jquery.waypoints.min.js"></script>
	<!-- Stellar Parallax -->
	<script src="js/jquery.stellar.min.js"></script>
	<!-- Main -->
	<script src="js/main.js"></script>

	<!-- bejson : Markdown convert Html -->
	<script src="../public/static/bejson/convert/markdown.min.js"></script>
	<script src="../public/static/bejson/convert/to-markdown.js"></script>

	<script type="text/javascript">
		var dataList = new Array();
		$(document).ready(function() {
			$.ajax({
                type:"get",
                url:"blog.xml",//这里通过设置url属性来获取xml
                dataType:"xml",
                timeout:1000,      //设定超时
                cache:false,       //是否设置缓存
                success:function(xml){//这里是解析xml
                    $(xml).find("blog").each(function(i){
                    	var location = $(this).attr("location");     // 跳转页面地址
                        var id_value = $(this).children("id").text();   // 唯一标识
                        var date = $(this).children("date").text();  // 日期
                        var title = $(this).children("title").text();  // 标题
                        var description = $(this).children("description").text();  // 描述
                        var cover = $(this).children("cover").text();  // 封面图片
                        var audio = $(this).children("audio").text();  // 音频地址
                        var markdownContent = $(this).children("markdown-content").text();  // markdown文本

                        var blog = {};
                        if (location.indexOf("english.html") != -1) {
                        	blog["location"] = location + "?id=" + id_value;
                        } else {
                        	blog["location"] = location;
                        }
                        
                        blog["id"] = id_value;
                        blog["date"] = date;
                        blog["title"] = title;
                        blog["description"] = description;
                        blog["cover"] = cover;
                        blog["audio"] = audio;
                        blog["content"] = markdownContent;
                        dataList.push(blog);                        
                    });
                    var englishId = getQueryString("id");
					fetchDetailData("english-content", englishId);
                }
            });
		})
	</script>

	<script type="text/javascript">
			function fetchDetailData(divIdentifier, englishId) {
				if (!divIdentifier) return;
				for (var i = 0; i < dataList.length; i++) {
					var data = dataList[i];
					if (data.id === englishId) {
						currentIndex = i;
						var audioHtmlStr = "<audio style=\"margin-bottom:20px\" preload=\"auto\" controls><source src=\""+ data.audio + "\" id='mp3_fileurl'></audio>";
						var textHtmlStr = convertMarkdownToHtml(data.content);
						// document.all[divIdentifier].innerHTML = content;
						// document.getElementById(divIdentifier).innerHTML = content;
						$("#" + divIdentifier).html(audioHtmlStr + textHtmlStr);// 使用jQuery
						$("#" + "fh5co-aside").css({"background-image" : "url("+ data.cover + ")"});
						$("#" + "post-date").html(data.date);
						$("#" + "post-title").html(data.title);

						// $(document).attr("title",data.title);
						$("title").html(data.title);

						// $(document).attr("description",data.description);
						$("description").html(data.description);

						var hasPrevious = i > 0;
						var hasNext = i < dataList.length - 1;

						if (hasPrevious) {
							var previous = dataList[i-1];
							$("#" + "previous-post-cover").css({"background-image" : "url("+ previous.cover + ")"});
							$("#" + "pervious-post-location").attr("href", previous.location);
							$("#" + "pervious-post-title").html(previous.title);
						} else {
							$("#" + "previous-post-cover").css({"background-image" : "url("+ data.cover + ")"});
							$("#" + "pervious-post-location").attr("href", data.location);
							$("#" + "pervious-post-title").html(data.title);
						}

						if (hasNext) {
							var next = dataList[i+1];
							$("#" + "next-post-cover").css({"background-image" : "url("+ next.cover + ")"});
							$("#" + "next-post-location").attr("href", next.location);
							$("#" + "next-post-title").html(next.title);
						} else {
							$("#" + "next-post-cover").css({"background-image" : "url("+ data.cover + ")"});
							$("#" + "next-post-location").attr("href", data.location);
							$("#" + "next-post-title").html(data.title);
						}						
						break;
					}
				}
				

			}
			function getQueryString(name) {
			  var reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)', 'i');
			  var r = window.location.search.substr(1).match(reg);
			  if (r != null) {
			    return unescape(r[2]);
			  }
			  return null;
			}
			function convertMarkdownToHtml(markdownStr){
				// showdown
			    // var converter = new showdown.Converter();
			    // var html = converter.makeHtml(markdown);

			    console.log('before:\n'+ markdownStr);

			    // 将XML中的/n解析为<br/>
			    markdownStr = markdownStr.replace(/\\n/g, '<br/>');

			    // bejson
			    var html = markdown.toHTML(markdownStr);
			    html = html.replace(/&lt;br\/&gt;/g, '<br/>');// html转码，换行符正确解析
			    html = html.replace(/<br\/>/g, '<br\/><br\/>');// 添加一个换行，美化排版
			    html = html.replace(/&amp;rsquo;/g, '\'');// &rsquo;正常解析为'

			    console.log('after:\n' + html);
			    
			    return html;
			}
	</script>

	</body>
</html>

